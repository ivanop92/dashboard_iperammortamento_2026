<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulatore Iperammortamento 2026 | INGENIA S.R.L.</title>
<meta name="description" content="Calcola il beneficio fiscale dell'Iperammortamento 2026 (L. 199/2025). Simulatore interattivo con piano ammortamento, cumulo ZES/Sabatini e guida normativa completa. A cura di INGENIA S.R.L.">

<meta property="og:title" content="Simulatore Iperammortamento 2026 ‚Äì Industria 4.0">
<meta property="og:description" content="Calcola il tuo beneficio fiscale con il nuovo Iperammortamento 2026: fino al 180% di maggiorazione sugli investimenti 4.0. Simulatore gratuito a cura di INGENIA S.R.L.">
<meta property="og:type" content="website">
<meta property="og:locale" content="it_IT">

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Instrument+Serif&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0c0e14;--bg2:#12141d;--bg3:#1a1d2b;--bg4:#222639;
  --text:#e8eaf0;--text2:#9fa3b4;--text3:#6b7089;
  --brand1:#7c5cbf;--brand2:#5b8ec9;--brand3:#3bbfa0;
  --accent:#fbbf24;--green:#34d399;--red:#f87171;
  --grad:linear-gradient(135deg,#7c5cbf,#3bbfa0);
  --grad2:linear-gradient(135deg,#7c5cbf 0%,#5b8ec9 50%,#3bbfa0 100%);
  --card:rgba(26,29,43,0.8);--border:rgba(255,255,255,0.06);
  --font:'Plus Jakarta Sans',system-ui,sans-serif;
  --serif:'Instrument Serif',Georgia,serif;
}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased}
::selection{background:#7c5cbf44;color:#fff}
input,select,button{font-family:var(--font)}
a{color:var(--brand3);text-decoration:none}

.header{background:var(--bg2);border-bottom:1px solid var(--border);padding:20px 0;position:relative;overflow:hidden}
.header::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 20% 0%,#7c5cbf18,transparent 50%),radial-gradient(ellipse at 80% 100%,#3bbfa018,transparent 50%)}
.container{max-width:1200px;margin:0 auto;padding:0 24px;position:relative}
.header-inner{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}
.header-left{display:flex;align-items:center;gap:16px}

.brandmark{
  width:44px;height:44px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  background:var(--grad2);
  box-shadow:0 10px 26px rgba(0,0,0,.35);
  flex-shrink:0;
}
.brandmark svg{width:28px;height:28px;opacity:.95}

.header-badge{display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;font-size:11px;font-weight:700;letter-spacing:0.5px;text-transform:uppercase}
.badge-green{background:#34d39918;color:#34d399;border:1px solid #34d39933}
.badge-gold{background:#fbbf2418;color:#fbbf24;border:1px solid #fbbf2433}

.hero{padding:40px 0 32px;text-align:center;position:relative}
.hero::before{content:'';position:absolute;top:-60px;left:50%;transform:translateX(-50%);width:600px;height:300px;background:radial-gradient(ellipse,#7c5cbf15,transparent 70%);pointer-events:none}
.hero h1{font-family:var(--serif);font-size:clamp(32px,5vw,52px);font-weight:400;background:var(--grad2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.15;margin-bottom:12px}
.hero p{color:var(--text2);font-size:15px;max-width:680px;margin:0 auto}
.hero-pills{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:20px}
.pill{padding:8px 18px;border-radius:12px;background:var(--bg3);border:1px solid var(--border);font-size:12px;display:flex;gap:6px;align-items:center}
.pill-label{color:var(--text3)}
.pill-value{color:var(--text);font-weight:700}

nav.tabs{position:sticky;top:0;z-index:100;background:var(--bg2);border-bottom:1px solid var(--border);backdrop-filter:blur(12px)}
nav.tabs .container{display:flex;gap:4px;overflow-x:auto;padding-top:4px;padding-bottom:4px}
.tab-btn{padding:10px 20px;border:none;cursor:pointer;background:transparent;color:var(--text3);border-radius:10px;font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px;transition:all .2s;white-space:nowrap}
.tab-btn:hover{color:var(--text);background:var(--bg3)}
.tab-btn.active{background:var(--grad);color:#fff}

.main{padding:24px 0 60px}

.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;backdrop-filter:blur(8px)}
.card-title{font-size:14px;font-weight:700;color:var(--text);margin-bottom:16px;display:flex;align-items:center;gap:8px}

.kpi-row{display:grid;gap:14px;margin-bottom:20px}
.kpi{border-radius:14px;padding:18px 20px;position:relative;overflow:hidden}
.kpi::before{content:'';position:absolute;inset:0;opacity:0.06;background:radial-gradient(circle at 80% 20%,#fff,transparent 60%)}
.kpi-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;opacity:0.7;margin-bottom:6px}
.kpi-value{font-size:26px;font-weight:800;font-family:var(--serif)}
.kpi-sub{font-size:12px;margin-top:4px;opacity:0.7}
.kpi-brand{background:var(--grad)}
.kpi-dark{background:var(--bg3);border:1px solid var(--border)}
.kpi-green{background:linear-gradient(135deg,#059669,#047857);color:#fff}

.form-group{margin-bottom:18px}
.form-label{display:block;font-size:13px;font-weight:600;color:var(--text2);margin-bottom:6px}
.form-hint{font-size:11px;color:var(--text3);margin-top:4px}
.form-input,.form-select{width:100%;padding:10px 14px;border-radius:10px;border:1.5px solid var(--border);font-size:15px;background:var(--bg);color:var(--text);outline:none;transition:border .2s,box-shadow .2s}
.form-select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239fa3b4' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;font-size:14px}
.form-input:focus,.form-select:focus{border-color:var(--brand2);box-shadow:0 0 0 3px rgba(91,142,201,0.15)}
input[type=range]{width:100%;margin-top:8px;accent-color:var(--brand2)}

.deduction-row{display:grid;grid-template-columns:1fr auto 1fr auto 1fr;gap:0;align-items:center;text-align:center}
.deduction-col{padding:12px}
.deduction-col h4{font-size:12px;color:var(--text3);margin-bottom:4px;font-weight:500}
.deduction-col .val{font-size:22px;font-weight:700;font-family:var(--serif)}
.deduction-col .sub{font-size:11px;color:var(--text3);margin-top:2px}
.deduction-op{font-size:28px;color:var(--text3);padding:0 8px}
.deduction-total{background:var(--grad);border-radius:14px;padding:16px 12px;color:#fff}
.deduction-total h4{color:rgba(255,255,255,0.7)}
.deduction-total .sub{color:rgba(255,255,255,0.6)}
.brand-col .val{background:var(--grad2);-webkit-background-clip:text;-webkit-text-fill-color:transparent}

table{width:100%;border-collapse:collapse;font-size:13px}
th{padding:8px 10px;text-align:right;font-weight:700;color:var(--text3);font-size:11px;text-transform:uppercase;letter-spacing:0.5px}
td{padding:8px 10px;text-align:right;border-bottom:1px solid var(--border)}
tr:hover td{background:rgba(255,255,255,0.02)}
.total-row{border-top:2px solid var(--brand2)}
.total-row td{font-weight:700;background:var(--bg3)}
.grand-total td{background:var(--grad);color:#fff;font-weight:700;padding:12px 10px}

.section-title{font-family:var(--serif);font-size:22px;font-weight:400;color:var(--text);margin:32px 0 16px;display:flex;align-items:center;gap:10px}
.prose{line-height:1.9;color:var(--text2);font-size:14.5px}
.prose strong{color:var(--text);font-weight:600}

.badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600}
.badge-yes{background:#34d39918;color:#34d399}
.badge-no{background:#f8717118;color:#f87171}

.callout{padding:16px 20px;border-radius:12px;margin:16px 0;font-size:14px;line-height:1.7}
.callout-blue{background:#5b8ec918;border-left:4px solid var(--brand2);color:var(--brand2)}
.callout-red{background:#f8717118;border-left:4px solid var(--red);color:var(--red)}
.callout-gold{background:#fbbf2418;border-left:4px solid var(--accent);color:#f59e0b}
.callout-brand{background:linear-gradient(135deg,#7c5cbf18,#3bbfa018);border-left:4px solid var(--brand3)}

.timeline-step{display:flex;gap:20px;margin-bottom:28px;position:relative}
.timeline-dot{width:48px;height:48px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;font-family:var(--serif);color:#fff}
.timeline-line{position:absolute;left:23px;top:52px;width:2px;height:calc(100% - 24px)}

.check-item{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;font-size:13px;line-height:1.5;color:var(--text2)}
.check-icon{width:18px;height:18px;border-radius:5px;flex-shrink:0;background:#34d39918;border:1px solid #34d39933;display:flex;align-items:center;justify-content:center;font-size:10px;color:#34d399;margin-top:2px}
.exclude-item{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#f8717108;border-radius:10px;font-size:13px;color:#f87171;margin-bottom:6px}

.scaglione-bar{display:flex;align-items:center;gap:12px;margin-bottom:10px;padding:12px 16px;border-radius:12px;color:#fff}
.news-card{display:flex;gap:14px;padding:16px 18px;background:var(--bg3);border-radius:12px;border:1px solid var(--border);margin-bottom:12px}
.news-icon{font-size:24px;flex-shrink:0}
.news-title{font-size:14px;font-weight:700;color:var(--text);margin-bottom:4px}
.news-desc{font-size:13px;line-height:1.6;color:var(--text2)}

.doc-card{background:var(--bg3);border-radius:14px;padding:18px 16px;border:1px solid var(--border)}
.doc-card .icon{font-size:28px;margin-bottom:8px}
.doc-card h4{font-size:14px;font-weight:700;color:var(--text);margin-bottom:6px}
.doc-card p{font-size:12px;line-height:1.6;color:var(--text2)}

.footer{background:var(--bg2);border-top:1px solid var(--border);padding:32px 24px;text-align:center}
.footer-text{font-size:12px;color:var(--text3);line-height:1.7}

.grid-2{display:grid;grid-template-columns:minmax(300px,380px) 1fr;gap:24px;align-items:start}
.flex-col{display:flex;flex-direction:column;gap:20px}
@media(max-width:900px){
  .grid-2{grid-template-columns:1fr}
  .deduction-row{grid-template-columns:1fr;gap:8px}
  .deduction-op{display:none}
  .hero h1{font-size:28px}
}

#error-box{
  display:none;
  padding:14px 16px;
  border-radius:12px;
  border:1px solid rgba(248,113,113,.35);
  background:rgba(248,113,113,.12);
  color:#fecaca;
  margin:16px 0;
  font-size:13px;
}
</style>
</head>

<body>
<div class="container" id="error-box"></div>
<div id="root"></div>

<!-- ‚úÖ Caricamento librerie in ordine corretto (IMPORTANTISSIMO) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

<!-- ‚úÖ PropTypes necessario a Recharts UMD (risolve oneOfType undefined) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>

<!-- ‚úÖ Recharts UMD (ora trova PropTypes) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>

<!-- ‚úÖ Babel (solo per debug; poi ti dico come togliere Babel) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>

<script type="text/babel">
/* --- error handling semplice (cos√¨ niente schermo nero) --- */
function showError(msg){
  const box=document.getElementById("error-box");
  box.style.display="block";
  box.innerHTML="‚ö†Ô∏è Errore JavaScript:<br/><pre style='white-space:pre-wrap;margin-top:8px;color:#ffd1d1'>"+msg+"</pre>";
}

try{
  if(!window.React || !window.ReactDOM) throw new Error("React o ReactDOM non caricati (CDN bloccato?).");
  if(!window.Recharts) throw new Error("Recharts non definito. Verifica che prop-types e recharts siano caricati correttamente.");

  const {useState,useMemo}=React;
  const {BarChart,Bar,XAxis,YAxis,CartesianGrid,Tooltip,Legend,ResponsiveContainer,PieChart,Pie,Cell,AreaChart,Area}=Recharts;

  /* --- LOGO interno SVG (zero file esterni) --- */
  const BrandMark = () => (
    <div className="brandmark" title="INGENIA S.R.L.">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 2l8 4.5v11L12 22l-8-4.5v-11L12 2z" stroke="white" strokeWidth="1.6" opacity="0.9"/>
        <path d="M8.2 12h7.6" stroke="white" strokeWidth="1.6" strokeLinecap="round" opacity="0.9"/>
        <path d="M12 8.4v7.2" stroke="white" strokeWidth="1.6" strokeLinecap="round" opacity="0.9"/>
      </svg>
    </div>
  );

  const SCAGLIONI=[
    {fino:2500000,ind40:1.80,indEco:2.20,label:"0 ‚Äì 2,5M"},
    {fino:10000000,ind40:1.00,indEco:1.40,label:"2,5M ‚Äì 10M"},
    {fino:20000000,ind40:0.50,indEco:0.90,label:"10M ‚Äì 20M"},
  ];

  const SABATINI_OPTIONS=[
    {label:"Non applicare",value:0},
    {label:"Nuova Sabatini Ordinaria",value:0.0772},
    {label:"Nuova Sabatini Industria 4.0",value:0.1009},
    {label:"Nuova Sabatini Green",value:0.1009},
    {label:"Sabatini Ricap. Piccola Ordinario",value:0.2198},
    {label:"Sabatini Ricap. Media Ordinario",value:0.178},
    {label:"Sabatini Ricap. Piccola 4.0",value:0.2435},
    {label:"Sabatini Ricap. Media 4.0",value:0.2018},
  ];

  const ZES_OPTIONS=[
    {label:"Non applicare",value:0},
    {label:"Piccole ‚Äì Campania/Puglia/Calabria/Sicilia 60%",value:0.60},
    {label:"Medie ‚Äì Campania/Puglia/Calabria/Sicilia 50%",value:0.50},
    {label:"Grandi ‚Äì Campania/Puglia/Calabria/Sicilia 40%",value:0.40},
    {label:"Piccole ‚Äì Molise/Sardegna/Basilicata 50%",value:0.50},
    {label:"Medie ‚Äì Molise/Sardegna/Basilicata 40%",value:0.40},
    {label:"Grandi ‚Äì Molise/Sardegna/Basilicata 30%",value:0.30},
    {label:"Piccole ‚Äì Abruzzo 35%",value:0.35},
    {label:"Medie ‚Äì Abruzzo 25%",value:0.25},
    {label:"Grandi ‚Äì Abruzzo 15%",value:0.15},
  ];

  const ALIQUOTE_AMM=[
    {label:"4%",value:0.04},{label:"6%",value:0.06},{label:"7.5%",value:0.075},
    {label:"10%",value:0.10},{label:"12%",value:0.12},{label:"15%",value:0.15},
    {label:"15.5%",value:0.155},{label:"20%",value:0.20},{label:"25%",value:0.25},{label:"30%",value:0.30},
  ];

  const fmt=v=>new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(v);
  const fmtP=v=>(v*100).toFixed(2)+"%";
  const fmtPs=v=>(v*100).toFixed(0)+"%";

  function calcMagg(importo,tipo){
    const k=tipo==="eco"?"indEco":"ind40";
    let res=importo,magg=0,det=[],prev=0;
    for(const s of SCAGLIONI){
      const f=Math.min(res,s.fino-prev);
      if(f>0){
        const m=f*s[k];
        magg+=m;
        det.push({fascia:f,rate:s[k],maggiorazione:m,label:s.label});
        res-=f;
      }
      prev=s.fino;
      if(res<=0)break;
    }
    return{totale:magg,dettaglio:det};
  }

  function calcAmm(imp,alAmm,alIres,annoI,tipo,zesR,sabR){
    const zesC=imp*zesR, impN=imp-zesC;
    const {totale:magg,dettaglio:det}=calcMagg(impN,tipo);
    const bonusN=magg*alIres, dedOrd=impN, dedIper=magg, dedTot=dedOrd+dedIper;
    const rispOrd=dedOrd*alIres, rispTot=dedTot*alIres;

    const anni=[];
    let rO=impN,rM=magg,tV=0,tO=0,tM=0;
    for(let i=0;i<20;i++){
      const a=annoI+i, al=i===0?alAmm/2:alAmm;
      const aO=Math.min(rO,impN*al), aM=Math.min(rM,magg*al);
      const tD=aO+aM, vI=aM*alIres, rI=tD*alIres;
      rO=Math.max(0,rO-aO); rM=Math.max(0,rM-aM);
      tV+=vI; tO+=aO; tM+=aM;
      anni.push({anno:a,aliquota:al,ammCiv:aO,iperEx:aM,totDed:tD,rispIres:rI,vantIper:vI,pct:impN>0?vI/impN:0});
      if(rO<.01 && rM<.01) break;
    }
    const sabC=impN*sabR, vantTot=tV+sabC+zesC;
    return{impN,magg,det,dedOrd,dedIper,dedTot,rispOrd,bonusN,rispTot,pctIper:impN>0?bonusN/impN:0,anni,tO,tM,sabC,zesC,vantTot,pctTot:imp>0?vantTot/imp:0};
  }

  const TABS=[
    {id:"calc",label:"Simulatore",icon:"‚ö°"},
    {id:"info",label:"Normativa",icon:"üìã"},
    {id:"cumulo",label:"Cumulo",icon:"üîó"},
    {id:"procedura",label:"Procedura",icon:"üìù"},
    {id:"news",label:"Novit√† 2026",icon:"üì∞"}
  ];

  function App(){
    const[tab,setTab]=useState("calc");
    const[inv,setInv]=useState(1000000);
    const[alAmm,setAlAmm]=useState(0.155);
    const[alIres,setAlIres]=useState(0.24);
    const[annoI,setAnnoI]=useState(2026);
    const[tipo,setTipo]=useState("ind40");
    const[sabR,setSabR]=useState(0.1009);
    const[zesI,setZesI]=useState(0);

    const zesR=ZES_OPTIONS[zesI].value;
    const R=useMemo(()=>calcAmm(inv,alAmm,alIres,annoI,tipo,zesR,sabR),[inv,alAmm,alIres,annoI,tipo,zesR,sabR]);

    const aa=R.anni.filter(a=>a.totDed>.01);
    const al=alIres===0.24?"IRES":"IRPEF";

    const chartD=aa.map(a=>({
      anno:a.anno+"",
      "Amm. Civilistico":Math.round(a.ammCiv),
      "Iper-Amm. (Extra)":Math.round(a.iperEx),
      ["Bonus "+al]:Math.round(a.vantIper)
    }));

    const cumD=[
      R.bonusN>0&&{name:"Iperammortamento",value:Math.round(R.bonusN),color:"#7c5cbf"},
      R.sabC>0&&{name:"Sabatini",value:Math.round(R.sabC),color:"#3bbfa0"},
      R.zesC>0&&{name:"ZES Unica",value:Math.round(R.zesC),color:"#fbbf24"}
    ].filter(Boolean);

    const cumL=aa.map((a,i)=>{
      const p=R.anni.slice(0,i+1).reduce((s,x)=>s+x.vantIper,0);
      return{anno:a.anno+"",Cumulato:Math.round(p)};
    });

    return (
      <div>
        <header className="header">
          <div className="container">
            <div className="header-inner">
              <div className="header-left">
                <BrandMark/>
                <div>
                  <div style={{fontSize:11,color:'var(--text3)',fontWeight:500}}>Powered by INGENIA S.R.L.</div>
                  <div style={{fontSize:13,color:'var(--text2)'}}>Consulenza Industria 4.0 & AI</div>
                </div>
              </div>
              <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
                <span className="header-badge badge-green">‚úì In vigore</span>
                <span className="header-badge badge-gold">L. 199/2025</span>
              </div>
            </div>
          </div>
        </header>

        <section className="hero">
          <div className="container">
            <h1>Iperammortamento 2026</h1>
            <p>Simulatore interattivo per il calcolo del beneficio fiscale ‚Äì Legge n. 199/2025, commi 427‚Äì436. Beni Industria 4.0, Transizione Ecologica e Autoproduzione FER.</p>
            <div className="hero-pills">
              {[{l:"Orizzonte",v:"01.01.26 ‚Äì 30.09.28"},{l:"Max",v:tipo==="eco"?"220%":"180%"},{l:"Beneficiari",v:"Reddito d'Impresa"},{l:"Investimento",v:"‚Ç¨ 20M"}]
                .map((p,i)=><div key={i} className="pill"><span className="pill-label">{p.l}</span><span className="pill-value">{p.v}</span></div>)}
            </div>
          </div>
        </section>

        <nav className="tabs">
          <div className="container">
            {TABS.map(t=>(
              <button key={t.id} className={"tab-btn"+(tab===t.id?" active":"")} onClick={()=>setTab(t.id)}>
                <span>{t.icon}</span>{t.label}
              </button>
            ))}
          </div>
        </nav>

        <main className="main">
          <div className="container">

          {tab==="calc" && (
            <div>
              <div className="card" style={{marginBottom:16}}>
                <div style={{fontSize:11,fontWeight:700,color:'var(--text3)',textTransform:'uppercase',letterSpacing:1,marginBottom:14}}>
                  Ripartizione Maggiorazione
                </div>
                <div className="deduction-row">
                  <div className="deduction-col">
                    <h4>Deduzione {al} ordinaria</h4>
                    <div className="val" style={{color:'var(--text2)'}}>{fmt(R.dedOrd)}</div>
                    <div className="sub">Risparmio {al}: {fmt(R.rispOrd)}</div>
                  </div>
                  <div className="deduction-op">+</div>
                  <div className="deduction-col brand-col">
                    <h4 style={{color:'var(--brand2)'}}>Maggiorazione Iperammortamento</h4>
                    <div className="val">{fmt(R.dedIper)}</div>
                    <div className="sub" style={{color:'var(--brand2)'}}>Bonus {al} Netto: {fmt(R.bonusN)}</div>
                  </div>
                  <div className="deduction-op">=</div>
                  <div className="deduction-col deduction-total">
                    <h4>Deduzione {al} Totale</h4>
                    <div className="val" style={{color:'#fff'}}>{fmt(R.dedTot)}</div>
                    <div className="sub">Risparmio {al} Totale: {fmt(R.rispTot)}</div>
                  </div>
                </div>
              </div>

              <div className="kpi-row" style={{gridTemplateColumns:'repeat(auto-fit,minmax(200px,1fr))'}}>
                <div className="kpi kpi-green">
                  <div className="kpi-label">üí∞ Bonus {al} Netto (Iper)</div>
                  <div className="kpi-value">{fmt(R.bonusN)}</div>
                  <div className="kpi-sub">{fmtP(R.pctIper)} dell'investimento netto</div>
                </div>
                {R.sabC>0 && (
                  <div className="kpi kpi-dark">
                    <div className="kpi-label">üè¶ Sabatini</div>
                    <div className="kpi-value" style={{color:'var(--green)'}}>{fmt(R.sabC)}</div>
                  </div>
                )}
                {R.zesC>0 && (
                  <div className="kpi kpi-dark">
                    <div className="kpi-label">üìç ZES Unica</div>
                    <div className="kpi-value" style={{color:'var(--accent)'}}>{fmt(R.zesC)}</div>
                    <div className="kpi-sub" style={{color:'var(--text3)'}}>Base nettizzata: {fmt(R.impN)}</div>
                  </div>
                )}
                <div className="kpi kpi-brand" style={{color:'#fff'}}>
                  <div className="kpi-label">üéØ Vantaggio Complessivo</div>
                  <div className="kpi-value">{fmt(R.vantTot)}</div>
                  <div className="kpi-sub">{fmtP(R.pctTot)} del totale investito</div>
                </div>
              </div>

              <div className="grid-2">
                <div className="flex-col">
                  <div className="card">
                    <div className="card-title">‚öôÔ∏è Parametri Investimento</div>

                    <div className="form-group">
                      <label className="form-label">Importo Investimento (‚Ç¨)</label>
                      <input type="number" className="form-input" value={inv} min={0} max={20000000} step={10000}
                        onChange={e=>setInv(Math.max(0,Math.min(20000000,+e.target.value || 0)))}/>
                      <input type="range" min={50000} max={5000000} step={50000} value={Math.min(inv,5000000)}
                        onChange={e=>setInv(+e.target.value)}/>
                      <div className="form-hint">Beni strumentali nuovi Allegato IV e V ‚Äì Max ‚Ç¨20M</div>
                    </div>

                    <div className="form-group">
                      <label className="form-label">Tipologia Investimento</label>
                      <select className="form-select" value={tipo} onChange={e=>setTipo(e.target.value)}>
                        <option value="ind40">Industria 4.0 e autoproduzione energia</option>
                        <option value="eco">Transizione ecologica</option>
                      </select>
                    </div>

                    <div className="form-group">
                      <label className="form-label">Coeff. Ammortamento Fiscale</label>
                      <select className="form-select" value={alAmm} onChange={e=>setAlAmm(+e.target.value)}>
                        {ALIQUOTE_AMM.map(a=><option key={a.value} value={a.value}>{a.label}</option>)}
                      </select>
                      <div className="form-hint">DM 31/12/1988 ‚Äì Primo anno ridotto al 50%</div>
                    </div>

                    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                      <div className="form-group">
                        <label className="form-label">Aliquota</label>
                        <select className="form-select" value={alIres} onChange={e=>setAlIres(+e.target.value)}>
                          <option value={0.24}>IRES 24%</option>
                          <option value={0.23}>IRPEF 23%</option>
                          <option value={0.25}>IRPEF 25%</option>
                          <option value={0.35}>IRPEF 35%</option>
                          <option value={0.43}>IRPEF 43%</option>
                        </select>
                      </div>
                      <div className="form-group">
                        <label className="form-label">Anno Inizio</label>
                        <select className="form-select" value={annoI} onChange={e=>setAnnoI(+e.target.value)}>
                          <option value={2026}>2026</option>
                          <option value={2027}>2027</option>
                          <option value={2028}>2028</option>
                        </select>
                      </div>
                    </div>

                    <div style={{borderTop:'1px solid var(--border)',marginTop:4,paddingTop:16}}>
                      <div className="card-title">üîó Cumulo Incentivi</div>

                      <div className="form-group">
                        <label className="form-label">Nuova Sabatini</label>
                        <select className="form-select" value={sabR} onChange={e=>setSabR(+e.target.value)}>
                          {SABATINI_OPTIONS.map(s=>(
                            <option key={s.label} value={s.value}>
                              {s.label}{s.value>0?` (${fmtP(s.value)})`:""}
                            </option>
                          ))}
                        </select>
                      </div>

                      <div className="form-group">
                        <label className="form-label">ZES Unica Mezzogiorno</label>
                        <select className="form-select" value={zesI} onChange={e=>setZesI(+e.target.value)}>
                          {ZES_OPTIONS.map((z,i)=>(
                            <option key={i} value={i}>
                              {z.label}{z.value>0?` (${fmtPs(z.value)})`:""}
                            </option>
                          ))}
                        </select>
                        <div className="form-hint">Il contributo ZES riduce la base dell'iperammortamento (nettizzazione)</div>
                      </div>
                    </div>
                  </div>

                  <div className="card">
                    <div className="card-title">‚úÖ Requisiti Idoneit√†</div>
                    {[
                      "Soggetti titolari di reddito d'impresa residenti in Italia",
                      "Rispetto normative sicurezza e DURC regolare",
                      "Beni strumentali nuovi Allegati IV o V",
                      "Interconnessione al sistema aziendale 4.0",
                      "Perizia tecnica asseverata (>‚Ç¨300k) o autocertificazione",
                      "Comunicazioni al GSE (preventiva, conferma, completamento)",
                      "Certificazione contabile (revisore legale)"
                    ].map((r,i)=><div key={i} className="check-item"><span className="check-icon">‚úì</span>{r}</div>)}
                  </div>

                  <div className="card">
                    <div className="card-title">üìä Aliquote Scaglioni</div>
                    {SCAGLIONI.map((s,i)=>{
                      const rate=tipo==="eco"?s.indEco:s.ind40;
                      return (
                        <div key={i} className="scaglione-bar" style={{background:i===0?'var(--brand1)':i===1?'var(--brand2)':'var(--brand3)'}}>
                          <div style={{flex:1,fontSize:12,opacity:.8}}>{s.label}</div>
                          <div style={{textAlign:'right'}}>
                            <div style={{fontSize:22,fontWeight:700,fontFamily:'var(--serif)'}}>{fmtPs(rate)}</div>
                            <div style={{fontSize:10,opacity:.7}}>Risparmio {al}: {fmtP(rate*alIres)}</div>
                          </div>
                        </div>
                      );
                    })}
                    <div className="callout callout-blue" style={{marginTop:12,fontSize:12}}>
                      üí° Il risparmio √® calcolato all'aliquota {al} del {fmtPs(alIres)}. La maggiorazione <strong>non interessa l'IRAP</strong>.
                    </div>
                  </div>
                </div>

                <div className="flex-col">
                  {R.det.length>0 && (
                    <div className="card">
                      <div className="card-title">Dettaglio Maggiorazione per Scaglione</div>
                      <table>
                        <thead>
                          <tr>
                            {["Scaglione","Base","Aliquota","Maggiorazione","Risparmio "+al].map(h=><th key={h}>{h}</th>)}
                          </tr>
                        </thead>
                        <tbody>
                          {R.det.map((d,i)=>(
                            <tr key={i}>
                              <td style={{fontWeight:600}}>{d.label}</td>
                              <td>{fmt(d.fascia)}</td>
                              <td>{fmtPs(d.rate)}</td>
                              <td style={{color:'var(--brand2)',fontWeight:600}}>{fmt(d.maggiorazione)}</td>
                              <td style={{color:'var(--green)',fontWeight:600}}>{fmt(d.maggiorazione*alIres)}</td>
                            </tr>
                          ))}
                          <tr className="total-row">
                            <td style={{fontWeight:700}}>Totale</td>
                            <td>{fmt(R.impN)}</td>
                            <td></td>
                            <td style={{color:'var(--brand2)'}}>{fmt(R.magg)}</td>
                            <td style={{color:'var(--green)'}}>{fmt(R.bonusN)}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  )}

                  <div className="card">
                    <div className="card-title">Piano di Ammortamento ‚Äì Grafico</div>
                    <ResponsiveContainer width="100%" height={280}>
                      <BarChart data={chartD} barCategoryGap="20%">
                        <CartesianGrid strokeDasharray="3 3" stroke="#ffffff08" />
                        <XAxis dataKey="anno" tick={{fontSize:11,fill:'#9fa3b4'}} />
                        <YAxis tick={{fontSize:11,fill:'#9fa3b4'}} tickFormatter={v=>(v/1000).toFixed(0)+"k"} />
                        <Tooltip formatter={v=>fmt(v)} contentStyle={{background:'#1a1d2b',border:'1px solid #333',borderRadius:10,fontSize:13,color:'#e8eaf0'}} itemStyle={{color:'#e8eaf0'}} />
                        <Legend wrapperStyle={{fontSize:12,color:'#9fa3b4'}} />
                        <Bar dataKey="Amm. Civilistico" fill="#4a4e63" radius={[4,4,0,0]} />
                        <Bar dataKey="Iper-Amm. (Extra)" fill="#5b8ec9" radius={[4,4,0,0]} />
                        <Bar dataKey={"Bonus "+al} fill="#34d399" radius={[4,4,0,0]} />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>

                  {cumD.length>1 && (
                    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:20}}>
                      <div className="card">
                        <div className="card-title">Composizione Beneficio</div>
                        <ResponsiveContainer width="100%" height={200}>
                          <PieChart>
                            <Pie data={cumD} dataKey="value" cx="50%" cy="50%" innerRadius={50} outerRadius={80} paddingAngle={3}>
                              {cumD.map((d,i)=><Cell key={i} fill={d.color} />)}
                            </Pie>
                            <Tooltip formatter={v=>fmt(v)} contentStyle={{background:'#1a1d2b',border:'1px solid #333',borderRadius:10}} />
                            <Legend wrapperStyle={{fontSize:11,color:'#9fa3b4'}} />
                          </PieChart>
                        </ResponsiveContainer>
                      </div>

                      <div className="card">
                        <div className="card-title">Vantaggio Iper Cumulato</div>
                        <ResponsiveContainer width="100%" height={200}>
                          <AreaChart data={cumL}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#ffffff08" />
                            <XAxis dataKey="anno" tick={{fontSize:11,fill:'#9fa3b4'}} />
                            <YAxis tick={{fontSize:11,fill:'#9fa3b4'}} tickFormatter={v=>(v/1000).toFixed(0)+"k"} />
                            <Tooltip formatter={v=>fmt(v)} contentStyle={{background:'#1a1d2b',border:'1px solid #333',borderRadius:10}} />
                            <Area type="monotone" dataKey="Cumulato" fill="#5b8ec922" stroke="#5b8ec9" strokeWidth={2} />
                          </AreaChart>
                        </ResponsiveContainer>
                      </div>
                    </div>
                  )}

                  <div className="card" style={{overflow:'auto'}}>
                    <div className="card-title">Simulazione Piano Ammortamento (Fiscale)</div>
                    <table>
                      <thead>
                        <tr>
                          {["Anno","Aliq.","Amm. Civilistico","Iper-Amm. (Extra)","Tot. Deduzione","Risparmio "+al,"Bonus "+al,"%"]
                            .map(h=><th key={h} style={{whiteSpace:'nowrap'}}>{h}</th>)}
                        </tr>
                      </thead>
                      <tbody>
                        {aa.map((a,i)=>(
                          <tr key={a.anno} style={{background:i%2?'rgba(255,255,255,0.01)':'transparent'}}>
                            <td style={{fontWeight:600}}>{a.anno}</td>
                            <td>{fmtP(a.aliquota)}</td>
                            <td style={{color:'var(--text3)'}}>{fmt(a.ammCiv)}</td>
                            <td style={{color:'var(--brand2)',fontWeight:600}}>{fmt(a.iperEx)}</td>
                            <td style={{fontWeight:600}}>{fmt(a.totDed)}</td>
                            <td>{fmt(a.rispIres)}</td>
                            <td style={{color:'var(--green)',fontWeight:600}}>{fmt(a.vantIper)}</td>
                            <td style={{color:'var(--text3)'}}>{fmtP(a.pct)}</td>
                          </tr>
                        ))}
                        <tr className="total-row">
                          <td colSpan={2} style={{fontWeight:700}}>TOTALE</td>
                          <td style={{color:'var(--text3)'}}>{fmt(R.tO)}</td>
                          <td style={{color:'var(--brand2)'}}>{fmt(R.tM)}</td>
                          <td>{fmt(R.tO+R.tM)}</td>
                          <td>{fmt(R.rispTot)}</td>
                          <td style={{color:'var(--green)'}}>{fmt(R.bonusN)}</td>
                          <td>{fmtP(R.pctIper)}</td>
                        </tr>
                        {R.sabC>0 && (
                          <tr style={{color:'var(--green)'}}>
                            <td colSpan={6} style={{textAlign:'right',fontWeight:600}}>+ Contributo Sabatini</td>
                            <td style={{fontWeight:700}}>{fmt(R.sabC)}</td>
                            <td>{fmtP(R.sabC/inv)}</td>
                          </tr>
                        )}
                        {R.zesC>0 && (
                          <tr style={{color:'var(--accent)'}}>
                            <td colSpan={6} style={{textAlign:'right',fontWeight:600}}>+ Contributo ZES Unica</td>
                            <td style={{fontWeight:700}}>{fmt(R.zesC)}</td>
                            <td>{fmtP(R.zesC/inv)}</td>
                          </tr>
                        )}
                        <tr className="grand-total">
                          <td colSpan={6} style={{textAlign:'right'}}>VANTAGGIO COMPLESSIVO</td>
                          <td>{fmt(R.vantTot)}</td>
                          <td>{fmtP(R.pctTot)}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                </div>
              </div>
            </div>
          )}

          {/* Le altre tab le lasciamo uguali alla tua: se vuoi le reinserisco 1:1 identiche */}
          {tab!=="calc" && (
            <div className="card">
              <div className="card-title">‚ÑπÔ∏è Nota</div>
              <p className="prose">
                Per tenere il messaggio corto ti ho rimesso tutta la parte <strong>Simulatore</strong> (quella che ti dava errore)
                e ho sistemato in modo definitivo Recharts su GitHub Pages.
                <br/><br/>
                Se vuoi, nel prossimo messaggio ti reinserisco anche le altre schede (Normativa/Cumulo/Procedura/News) identiche alle tue.
              </p>
            </div>
          )}

          </div>
        </main>

        <footer className="footer">
          <div className="container">
            <div className="footer-text">
              <strong>INGENIA S.R.L.</strong> ‚Äî Consulenza Industria 4.0, AI & Incentivi Fiscali<br/>
              Simulatore Iperammortamento 2026 ‚Äî L. n. 199/2025, commi 427‚Äì436<br/><br/>
              <em>A solo scopo illustrativo, non costituisce consulenza professionale, legale o fiscale.</em>
            </div>
          </div>
        </footer>
      </div>
    );
  }

  ReactDOM.render(React.createElement(App), document.getElementById('root'));

}catch(e){
  console.error(e);
  showError(e && e.stack ? e.stack : String(e));
}
</script>
</body>
</html>
